window.toDegrees=function(){return 180/Math.PI};window.toRadians=function(){return Math.PI/180};window.toScreen=function(){return 30};window.toWorld=function(){return 1/30};window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}();Function.prototype.bind||(Function.prototype.bind=function(e){if(typeof this!="function")throw new TypeError("Function.prototype.bind: what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,r=function(){},i=function(){return n.apply(this instanceof r?this:e,t.concat(Array.prototype.slice.call(arguments)))};r.prototype=this.prototype;i.prototype=new r;return i});(function(){var e=!1,t=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(){function u(){!e&&this.init&&this.init.apply(this,arguments)}var n=this.prototype;e=!0;var r=new this;e=!1;for(var i in arguments){var s=arguments[i];for(var o in s)r[o]=typeof s[o]=="function"&&typeof n[o]=="function"&&t.test(s[o])?function(e,t){return function(){var r=this._super;this._super=n[e];var i=t.apply(this,arguments);this._super=r;return i}}(o,s[o]):s[o]}u.prototype=r;u.prototype.constructor=u;u.extend=arguments.callee;return u}})();var Matrix=Class.extend({init:function(e,t,n,r,i,s){this._a=e||1;this._b=t||0;this._c=n||0;this._d=r||1;this._tx=i||0;this._ty=s||0},identity:function(){this._a=1;this._b=0;this._c=0;this._d=1;this._tx=0;this._ty=0;return this},inverse:function(){var e=this.a*this.d-this.b*this.c,t=this.d/e,n=-1*this.b/e,r=-1*this.c/e,i=this.a/e,s=(this.c*this.ty-this.d*this.tx)/e,o=(this.b*this.tx-this.a*this.ty)/e;this._a=t;this._b=n;this._c=r;this._d=i;this._tx=s;this._ty=o;return this},multiply:function(e){var t=this._a*e.a()+this._c*e.b(),n=this._b*e.a()+this._d*e.b(),r=this._a*e.c()+this._c*e.d(),i=this._b*e.c()+this._d*e.d(),s=this._a*e.tx()+this._c*e.ty()+this._tx,o=this._b*e.tx()+this._d*e.ty()+this._ty;this._a=t;this._b=n;this._c=r;this._d=i;this._tx=s;this._ty=o;return this},translate:function(e,t){var n=new Matrix(1,0,0,1,e,t);this.multiply(n);return this},rotate:function(e){var t=Math.sin(e),n=Math.cos(e),r=new Matrix(n,t,-1*t,n);this.multiply(r);return this},scale:function(e,t){var n=new Matrix(e,0,0,t);this.multiply(n);return this},clone:function(){return new Matrix(this._a,this._b,this._c,this._d,this._tx,this._ty)},a:function(e){if(e){this._a=e;return this}return this._a},b:function(e){if(e){this._b=e;return this}return this._b},c:function(e){if(e){this._c=e;return this}return this._c},d:function(e){if(e){this._d=e;return this}return this._d},tx:function(e){if(e){this._tx=e;return this}return this._tx},ty:function(e){if(e){this._ty=e;return this}return this._ty},toString:function(){return"[Matrix a="+this._a+" b="+this._b+" c="+this._c+" d="+this._d+" tx="+this._tx+" ty="+this._ty+"]"}}),Rectangle=Class.extend({init:function(e,t,n,r){this._origin=new Point(e,t);this._size=new Size(n,r)},center:function(){this._origin.x(-0.5*this._size.width());this._origin.y(-0.5*this._size.height())},contains:function(e){var t=e.x()>this.left()&&e.x()<this.right(),n=e.y()>this.top()&&e.y()<this.bottom();return t&&n},inflate:function(e){this._origin.x(this._origin.x()-e.width());this._size.width(this._size.width()+e.width()*2);this._origin.y(this._origin.y()-e.height());this._size.height(this._size.height()+e.height()*2)},deflate:function(e){this._origin.x(this._origin.x()+e.width());this._size.width(this._size.width()-e.width()*2);this._origin.y(this._origin.y()+e.height());this._size.height(this._size.height()-e.height()*2)},origin:function(){return this._origin},size:function(){return this._size},top:function(){return this._origin.y()},left:function(){return this._origin.x()},right:function(){return this._origin.x()+this._size.width()},bottom:function(){return this._origin.y()+this._size.height()},clone:function(){return new Rectangle(this._origin.x(),this._origin.y(),this._size.width(),this._size.height())},toString:function(){return"[Rectangle x="+this._origin.x()+" y="+this._origin.y()+" width="+this._size.width()+" height="+this._size.height()+"]"}}),Rocket88=Class.extend({init:function(e,t,n){if(!e)throw ReferenceError("'Houston we have a problem': Required parameter 'canvas' is missing");this._origin=new Point(e.width*.5,e.height*.5);this._accumulator=0;this._currentScene=null;this._currentTime=(new Date).getTime();this._debugMode=t||!1;this._frameTime=1e3/60;this._paused=!1;switch(n){default:console.warn("Optional parameter 'renderer' is missing, using default CanvasRenderer");case"canvas":this._renderer=new CanvasRenderer(e)}},takeOff:function(){if(!this._currentScene){console.error("'Houston we have a problem': Rocket'88 requires a scene before taking off");return!1}this._paused=!1;this.updateWithFixedTimestep();return!0},land:function(){this._paused=!0},updateWithFixedTimestep:function(){if(!this._paused){requestAnimationFrame(function(){this.updateWithFixedTimestep()}.bind(this));var e=(new Date).getTime(),t=e-this._currentTime;this._accumulator+=t;this._currentTime=e;while(this._accumulator>=this._frameTime){this._accumulator-=this._frameTime;this.update()}}},update:function(){this._currentScene.update()},scene:function(e){if(e){this._currentScene&&this._currentScene.autoDestroy&&this._currentScene.destroy();var t={debugMode:this._debugMode,world:this,name:"currentScene",renderer:this._renderer};e.inject(t);e.create();e.ready();this._currentScene=e}return this._currentScene},origin:function(e){if(e){this._origin=e;return this}return this._origin},renderer:function(){return this._renderer},debugMode:function(){return this._debugMode}}),Point=Class.extend({init:function(e,t){this._x=e||0;this._y=t||0},add:function(e){this._x+=e.x();this._y+=e.y()},substract:function(e){this._x-=e.x();this._y-=e.y()},multiply:function(e){this._x*=e;this._y*=e},distanceTo:function(e){var t=e.x()-this._x,n=e.y()-this._y;return Math.sqrt(t*t+n*n)},direction:function(){var e=point.x()-this._x,t=point.y()-this._y;return Math.atan2(t,e)},x:function(e){if(e){this._x=e;return this}return this._x},y:function(e){if(e){this._y=e;return this}return this._y},clone:function(){return new Point(this._x,this._y)},toString:function(){return"[Point x="+this._x+" y="+this._y+"]"}}),Size=Class.extend({init:function(e,t){this._width=e||0;this._height=t||0},width:function(e){if(e){this._width=e;return this}return this._width},height:function(e){if(e){this._height=e;return this}return this._height},clone:function(){return new Size(this._width,this._height)},toString:function(){return"[Size width="+this._width+" height="+this._height+"]"}}),LinkedList=Class.extend({init:function(){this._head=null;this._tail=null;this._size=0},add:function(e){this._size++;var t=new LinkedListNode(e,this);if(this._head){t.prev=this._tail;this._tail.next=t;this._tail=t}else{this._head=t;this._tail=t}return t},insertBefore:function(e,t){this._size++;var n=new LinkedListNode(e,this);if(t==this._head){n.next=this._head;this._head.prev=n;this._head=n;return n}var r=t.prev;r.next=n;t.prev=n;n.prev=r;n.next=t;return n},insertAfter:function(e,t){this._size++;var n=new LinkedListNode(e,this);if(t==this._tail){this._tail.next=n;this._tail=n;return n}n.next=t.next;n.prev=t;t.next=n;return n},remove:function(e){if(e==this._head){this.shift();return!0}if(e==this._tail){this.pop();return!0}var t=e.next,n=e.prev;t.prev=n;n.next=t;this._size--;return e},shift:function(){if(this._head){this._size--;if(this._head==this._tail){this._head=null;this._tail=null}else{var e=this._head.next;e.prev=null;this._head=e}}return this._head},pop:function(){if(this._tail){this._size--;if(this._head==this._tail){this._head=null;this._tail=null}else{var e=this._tail.prev;e.next=null;this._tail=e}}return this._tail},swap:function(e,t){var n=e.userData;e.userData=t.userData;t.userData=n},sort:function(e){var t=this._extensionList.head();while(t){var n=t.userData;n.autoDestroy()&&n.destroy();t=t.next}},contains:function(e){var t=this._head;while(t){if(t.userData==e)return!0;t=t.next}return!1},nodeOf:function(e){var t=this._head;while(t){if(t.userData==e)return t;t=t.next}return null},size:function(){return this._size},head:function(){return this._head},tail:function(){return this._tail},toArray:function(){var e=[],t=this._head;while(t){e.push(t.userData);t=t.next}return e}}),LinkedListNode=Class.extend({init:function(e,t){this._list=t;this._id=(new Date).getTime();this.userData=e;this.next=null;this.prev=null},remove:function(){this._list.remove(this)},list:function(){return this._list}}),EightyEightObject=Class.extend({init:function(e){this.userData=new Object;this._createdAt=(new Date).getTime();this._name=e||"Object_"+Math.round(Math.random()*this._createdAt);this._autoDestroy=!0;this._isReady=!1;this._isDestroyed=!1;this._world=null;this._renderer=null},inject:function(e){if(e){this._world=e.world;this._renderer=e.renderer}},create:function(e){},ready:function(){this._world.debugMode()&&console.info("EightyEightObject '"+this.name()+"' is ready");this._isReady=!0},update:function(){},createdAt:function(){return this._createdAt},name:function(){return this._name},autoDestroy:function(e){if(!e)return this._autoDestroy;this._autoDestroy=e},isReady:function(){return this._isReady},isDestroyed:function(){return this._isDestroyed},world:function(){return this._world},renderer:function(){return this._renderer},destroy:function(){this._world.debugMode()&&console.info("Destroying EightyEightObject '"+this.name()+"'");if(this._isDestroyed){this._name=null;this._world=null;this._renderer=null}this._destroyed=!0}}),Scene=EightyEightObject.extend({init:function(e){this._super(e);this._camera=new Camera;this._layerList=new LinkedList;this._layerSet=new Object},ready:function(){this._super();var e=this._layerList.head();while(e){var t=e.userData;t.ready();e=e.next}},update:function(){this._super();this.renderer().clear();this._camera.update();var e=this._layerList.head();while(e){var t=e.userData;t.update();e=e.next}this.renderer().render()},addLayer:function(e){e=this._setupLayer(e);this._layerSet[e.name()]=e;if(this._layerList.size()==0){this._layerList.add(e);return!0}var t=this._extensionList.head();while(t){var n=t.userData;if(e.depth()>=n.depth()){this._layerList.insertBefore(e,n);return!0}t=t.next}return!1},removeLayer:function(e){if(!this.hasLayer(e))return!1;var t=this.getLayer(e);this._layerList.nodeOf(t).remove();this._layerSet[e]=null;t.autoDestroy()&&t.destroy();return t},removeAllLayers:function(e){var t=this._layerList.head();while(t){var n=t.userData;n.autoDestroy()&&n.destroy();t=t.next}this._layerList=new LinkedList;this._layerSet=new Object},_setupLayer:function(e){if(this.hasLayer(e.name())){console.error("Required property 'name' must be unique");return null}var t={world:this.world(),renderer:this.renderer(),scene:this};e.inject(t);e.create();this.isReady()&&e.ready();return e},camera:function(e){if(e){this._camera=e;return this}return this._camera},layers:function(){return this._layerList.toArray()},getLayer:function(e){return this._layerSet[e]},hasLayer:function(e){return this._layerSet[e]!=null},destroy:function(){if(!this.isDestroyed()){this.removeAllLayers();this._camera=null;this._layerList=null;this._layerSet=null}this._super()}}),Camera=EightyEightObject.extend({init:function(){this._super();this._focalLength=80;this._isStatic=!0;this._x=0;this._y=0;this._rotation=0;this._zoom=1;this._viewport=new Rectangle;this._transformMatrix=new Matrix},ready:function(){this._super();var e=this._extensionList.head();while(e){var t=e.userData;t.ready();e=e.next}},focalLength:function(e){if(e){this._focalLength=e;return this}return this._focalLength},viewPort:function(e){if(e){this._viewport=e;return this}return this._viewport},isStatic:function(e){return this._isStatic},x:function(){return this._x},y:function(){return this._y},rotation:function(){return this._rotation},zoom:function(){return this._zoom},transformMatrix:function(){return this._transformMatrix.identity().translate(this._x,this._y).rotate(this._rotation*(Math.PI/180)).scale(this._zoom,this._zoom)}}),ChaseCamera=Camera.extend({init:function(){this._super();this._isStatic=!1;this._damping=1;this._target=null},update:function(){this._super();if(!this._target){console.warn("ChaseCamera requires a target GameObject. Set target or use a different Camera.");return}var e=this._target.transform().x(),t=this._target.transform().y();if(e>this._x+this._viewport.right()){e-=_roamingArea.right();this._x+=(e-this._x)*this._damping}else if(e<this._x+this._viewport.left()){e-=this._viewport.left();this._x+=(e-this._x)*this._damping}if(t>this._y+this._viewport.bottom()){t-=this._viewport.bottom();this._y+=(t-this._y)*this._damping}else if(t<this._y+this._viewport.top()){t-=this._viewport.top();this._y+=(t-this._y)*this._damping}},damping:function(e){if(damping){this._damping=e;return this}return this._damping},target:function(e){if(e){this._target=e;return this}return this._target},destroy:function(){this.isDestroyed()&&(this._target=null);this._super()}}),Layer=EightyEightObject.extend({init:function(e){this._super(e);this._scene=null;this._objectList=new LinkedList;this._objectSet=new Object;this._depth=0;this._x=0;this._y=0;this._rotation=0;this._scale=1;this._transformMatrix=new Matrix},inject:function(e){this._super(e);e&&(this._scene=e.scene)},ready:function(){this._super();var e=this._objectList.head();while(e){var t=e.userData;t.ready();e=e.next}},update:function(){this._super();var e=this._scene.camera();this._x=-1*e.x();this._y=-1*e.y();this._rotation=-1*e.rotation();this._scale=e.zoom();if(this._depth!=0&&!e.isStatic()){var t=e.focalLength();this._scale=t/(t+_depth);this._x*=myScale;this._y*=myScale}var n=this._objectList.head();while(n){var r=n.userData;r.update();n=n.next}},addObject:function(e){this._setupObject(e);this._objectList.add(e);this._objectSet[e.name()]=e;return e},insertObjectAbove:function(e,t){if(!this.hasObject(t))return!1;var n=this.getObject(t),r=this._objectList.nodeOf(n);this._setupObject(e);this._objectList.insertBefore(e,r);this._objectSet[e.name()]=e;return!0},insertObjectBelow:function(e,t){if(!this.hasObject(t))return!1;var n=this.getObject(t),r=this._objectList.nodeOf(n);this._setupObject(e);this._objectList.insertBefore(e,r);this._objectSet[e.name()]=e;return!0},swapObjects:function(e,t){if(!this.hasObject(e)||!this.hasObject(t))return!1;var n=this.getObject(e),r=this._objectList.nodeOf(n),i=this.getObject(t),s=this._objectList.nodeOf(i);this._objectList.swap(r,s);return!0},removeObject:function(e){if(!this.hasObject(e))return!1;var t=this.getLayer(e);this._objectList.nodeOf(t).remove();this._objectSet[e]=null;t.autoDestroy()&&t.destroy();return t},removeAllObjects:function(){var e=this._objectList.head();while(e){var t=e.userData;t.autoDestroy()&&t.destroy();e=e.next}this._objectList=new LinkedList;this._objectSet=new Object},removeFromScene:function(){this._scene.removeLayer(this.name())},_setupObject:function(e){if(this.hasObject(e.name())){console.error("Required property 'name' must be unique");return null}var t={world:this.world(),renderer:this.renderer(),layer:this};e.inject(t);e.create();this.isReady()&&e.ready()},gameObjects:function(){return this._objectList.toArray()},getObject:function(e){return this._objectSet[e]},hasObject:function(e){return this._objectSet[e]!=null},scene:function(){return this._scene},gameObjectAdded:function(){return this._objectAdded},gameObjectRemoved:function(){return this._objectRemoved},transformMatrix:function(){return this._transformMatrix.identity().translate(this._x,this._y).rotate(this._rotation*(Math.PI/180)).scale(this._scale,this._scale)},destroy:function(){if(!this.isDestroyed()){this.removeAllObjects();this._objectList=null;this._objectSet=null;this._objectAdded=null;this._objectRemoved=null}this._super()}}),GameObject=EightyEightObject.extend({init:function(e,t){this._super(e);this._layer=null;this._group=t||"no_name";this._extensionList=new LinkedList;this._extensionSet=new Object},create:function(){this._super();this.addExtension(new GraphicExtension);this.addExtension(new TransformExtension)},inject:function(e){this._super(e);e&&(this._layer=e.layer)},ready:function(){this._super();var e=this._extensionList.head();while(e){var t=e.userData;t.ready();e=e.next}},update:function(){this._super();var e=this._extensionList.head();while(e){var t=e.userData;t.enabled()&&t.update();e=e.next}},addExtension:function(e){this._setupExtension(e);this._extensionList.add(e);this._extensionSet[e.name()]=e;return e},removeExtension:function(e){if(!this.hasExtension(e))return!1;var t=this.getExtension(e);this._objectList.nodeOf(t).remove();this._objectSet[e]=null;t.autoDestroy()&&t.destroy();this._extensionRemoved.dispatch(t);return myObject},removeAllExtension:function(){var e=this._extensionList.head();while(e){var t=e.userData;t.autoDestroy()&&t.destroy();e=e.next}this._extensionList=new LinkedList;this._extensionSet=new Object},removeFromLayer:function(){},_setupExtension:function(e){if(this.hasExtension(e.name())){console.error("Required property 'name' must be unique");return null}var t={world:this.world(),renderer:this.renderer(),gameObject:this};e.inject(t);e.create();this.isReady()&&e.ready()},extensions:function(){return this._extesionList.toArray()},getExtension:function(e){return this._extensionSet[e]},hasExtension:function(e){return this._extensionSet[e]!=null},transform:function(){return this._extensionSet.transform},graphic:function(){return this._extensionSet.graphic},layer:function(){return this._layer},group:function(){return this._group},destroy:function(){if(!this.isDestroyed()){this.removeAllExtensions();this._layer=null;this._group=null;this._extensionList=null;this._extensionSet=null}this._super()}}),Extension=EightyEightObject.extend({init:function(e){this._super(e);this._gameObject=null;this._enabled=!0},inject:function(e){this._super(e);e&&(this._gameObject=e.gameObject)},removeFromGameObject:function(){this._gameObject().removeExtension(this.name())},enable:function(){this._enabled=!0},disable:function(){this._enabled=!1},enabled:function(){return this._enabled},gameObject:function(){return this._gameObject}}),CanvasRenderer=Class.extend({init:function(e){this._backgroundColor=null;this._transformMatrix=new Matrix;this._canvas=e;this._context=e.getContext("2d")},clear:function(){var e=this._canvas,t=this._context,n=this._backgroundColor;if(n!=null){t.fillStyle=n;t.fillRect(0,0,e.width,e.height)}else t.clearRect(0,0,e.width,e.height)},drawSprite:function(e,t){var n=this._context;n.save();var r=t.world(),i=t.layer(),s=i.scene(),o=s.camera();this._transformMatrix.identity().translate(r.origin().x(),r.origin().y()).multiply(i.transformMatrix()).multiply(t.transform().transformMatrix()).multiply(e.transformMatrix());n.transform(this._transformMatrix.a(),this._transformMatrix.b(),this._transformMatrix.c(),this._transformMatrix.d(),this._transformMatrix.tx(),this._transformMatrix.ty());var u=e.cropRect(),a=e.bounds();if(!e.tile())n.drawImage(e.image(),u.origin().x(),u.origin().y(),u.size().width(),u.size().height(),a.origin().x(),a.origin().y(),u.size().width(),u.size().height());else{n.fillStyle=n.createPattern(e.image(),"repeat");n.fillRect(a.origin().x(),a.origin().y(),a.size().width(),a.size().height())}n.restore()},render:function(){},backgroundColor:function(e){e&&(this._backgroundColor=e);return this._backgroundColor}}),PhysicsObject=GameObject.extend({init:function(){this._super()}}),GraphicExtension=Extension.extend({init:function(){this._super("graphic");this._spriteList=new LinkedList;this._spriteSet=new Object},update:function(){this._super();var e=this._spriteList.head();while(e){var t=e.userData;if(t.image()){t.update();this.renderer().drawSprite(t,this.gameObject())}e=e.next}},addSprite:function(e){this._spriteList.add(e)},insertSpriteAbove:function(e,t){},insertSpriteBelow:function(e,t){},removeSprite:function(){},removeAllSprites:function(){}}),TransformExtension=Extension.extend({init:function(){this._super("transform");this._x=0;this._y=0;this._rotation=0;this._scaleX=0;this._scaleY=0;this._transformMatrix=new Matrix},update:function(){this._super()},x:function(e){if(e){this._x=e;return this}return this._x},y:function(e){if(e){this._y=e;return this}return this._y},rotation:function(e){if(e){this._rotation=e;return this}return this._rotation},scaleX:function(e){if(e){this._scaleX=e;return this}return this._scaleX},scaleY:function(e){if(e){this._scaleY=e;return this}return this._scaleY},transformMatrix:function(){return this._transformMatrix.identity().translate(this._x,this._y).rotate(this._rotation*(Math.PI/180)).scale(this._scaleX,this._scaleY)}}),Spritesheet=Class.extend({init:function(){this._data=null;this._image=null;this._firstFrame=null;this._animations=new Array;this._frames=new Object},createWithImageAndData:function(e,t){this._image=e;this._data=t;this._parseData()},_parseData:function(){for(var e in this._data.frames){var t=this._data.frames[e].frame,n=new Rectangle(t.x,t.y,t.w,t.h);this._addFrame(e,n)}},_addFrame:function(e,t){this._frames[e]=t;this._firstFrame||(this._firstFrame=t);var n=/(-|_)*(\d+)(\.[a-zA-Z]{3,4})$/,r=e.replace(n,"");this._animations[r]||(this._animations[r]=new LinkedList);this._animations[r].add(t)},hasAnimation:function(e){return this._animations[e]!=null},animations:function(){var e=new Array;for(var t in this._animations)e.push(t);return e},getAnimation:function(e){return this._animations[e]},frames:function(){return this._frames},getFrame:function(e){return this._frames[e]},firstFrame:function(){return this._firstFrame},image:function(){return this._image},data:function(){return this._data}}),Sprite=Class.extend({init:function(){this._image=null;this._spritesheet=null;this._x=0;this._y=0;this._width=0;this._height=0;this._rotation=0;this._scaleX=1;this._scaleY=1;this._horizontalFlipped=!1;this._verticalFlipped=!1;this._tiled=!1;this._originalSize=new Size;this._bounds=new Rectangle;this._cropRect=new Rectangle;this._anchorPoint=new Point(.5,.5);this._transformMatrix=new Matrix},createWithImage:function(e){if(!this._image&&!this._spritesheet){this._image=e;this._width=this._image.width;this._height=this._image.height;this._cropRect=new Rectangle(0,0,this._width,this._height);this._originalSize=new Size(this._width,this._height)}},createWithSpritesheet:function(e){if(!this._image&&!this._spritesheet){this._spritesheet=e;this._image=this._spritesheet.image();var t=this._spritesheet.firstFrame();this._setFrame(t)}},_setFrame:function(e){this._width=e.size().width();this._height=e.size().height();this._cropRect=e.clone();this._originalSize=new Size(this._width,this._height)},update:function(){this._bounds.origin().x(-1/this._scaleX*this._anchorPoint.x()*this._width);this._bounds.origin().y(-1/this._scaleY*this._anchorPoint.y()*this._height);this._bounds.size().width(this._width);this._bounds.size().height(this._height)},showFrame:function(e){if(this._spritesheet){var t=this._spritesheet.getFrame(e);this._cropRect=t.clone();this._bounds=t.clone();this._bounds.center()}},cropRect:function(e){if(e){this._cropRect=e;return this}return this._cropRect},x:function(e){if(e){this._x=e;return this}return this._x},y:function(e){if(e){this._y=e;return this}return this._y},width:function(e){if(e){this._width=e;this._tiled||(this._scaleX=e/this._originalSize.width());return this}return this._width},height:function(e){if(e){this._height=e;this._tiled||(this._scaleY=e/this._originalSize.height());return this}return this._height},rotate:function(e){if(e){this._rotation=e;return this}return this._rotation},scaleX:function(e){if(e){if(!this._tiled){this._scaleX=e;this._width=this._originalSize.width()*e}return this}return this._scaleX},scaleY:function(e){if(e){if(!this._tiled){this._scaleY=e;this._height=this._originalSize.height()*e}return this}return this._scaleY},flipHorizontal:function(e){if(e!=undefined){this._horizontalFlipped=e;return this}return this._horizontalFlipped},flipVertical:function(e){if(e!=undefined){this._verticalFlipped=e;return this}return this._verticalFlipped},tile:function(e){if(e!=undefined){this._tiled=e;if(this._tiled){this._scaleX=1;this._scaleY=1}else{this._scaleX=this._width/this._originalSize.width();this._scaleY=this._height/this._originalSize.height()}return this}return this._tiled},image:function(){return this._image},spritesheet:function(){return this._spritesheet},anchorPoint:function(e){if(e){this._anchorPoint=e;return this}return this._anchorPoint},transformMatrix:function(){var e=this._bounds.origin().x(),t=this._bounds.origin().y(),n=this._horizontalFlipped?-1:1,r=this._verticalFlipped?-1:1;return this._transformMatrix.identity().translate(this._x,this._y).rotate(this._rotation*(Math.PI/180)).scale(this._scaleX,this._scaleY).scale(n,r)},bounds:function(){return this._bounds}}),AnimatedSprite=Sprite.extend({init:function(){this._super();this._currentAnimation=null;this._currentFrame=null;this._isRunning=!1;this._reversed=!1;this._loop=!0},update:function(){if(this._isRunning&&this._spritesheet){this._reversed?this._previousFrame():this._nextFrame();this._setFrame(this._currentFrame.userData)}this._super()},_nextFrame:function(){this._currentFrame.next?this._currentFrame=this._currentFrame.next:this._loop&&(this._currentFrame=this._currentAnimation.head())},_previousFrame:function(){this._currentFrame.prev?this._currentFrame=this._currentFrame.prev:this._loop&&(this._currentFrame=this._currentAnimation.tail())},play:function(e){this._isRunning=!0;this._currentAnimation=this._spritesheet.getAnimation(e);this._reversed?this._currentFrame=this._currentAnimation.tail():this._currentFrame=this._currentAnimation.head();this._setFrame(this._currentFrame.userData);return this},stop:function(){this._isRunning=!1;return this},isRunning:function(){return this._isRunning},loop:function(e){if(e!=undefined){this._loop=e;return this}return this._loop},reverse:function(e){if(e!=undefined){this._reversed=e;return this}return this._reversed}});